<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –≤—Ö–æ–¥–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>–û—Ç–ª–∞–¥–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
    <div>
        <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <button onclick="checkUsers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
    </div>
    
    <div>
        <h3>–®–∞–≥ 2: –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</h3>
        <input type="email" id="email" placeholder="Email" value="">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="">
        <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
    </div>
    
    <div>
        <h3>–®–∞–≥ 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button onclick="registerTestUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å test@example.com</button>
    </div>
    
    <div id="result"></div>

    <script>
        const supabaseUrl = 'https://mcdhnxkzsbcifsaijieu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jZGhueGt6c2JjaWZzYWlqaWV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4ODEwOTAsImV4cCI6MjA3MzQ1NzA5MH0.njdhv1MANZ0K1EFTsfAl61F38aVxspkgtbNo2GGZUYY';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function checkUsers() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
                const { data: session } = await supabase.auth.getSession();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª–∏
                const { data: profiles, error: profilesError } = await supabase
                    .from('profiles')
                    .select('*');
                
                result.innerHTML = `
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>
                    <p><strong>–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è:</strong> ${session.session ? `–ï—Å—Ç—å (${session.session.user.email})` : '–ù–µ—Ç'}</p>
                    <p><strong>–ü—Ä–æ—Ñ–∏–ª–∏ –≤ –ë–î:</strong> ${profilesError ? '–û—à–∏–±–∫–∞: ' + profilesError.message : profiles.length + ' –Ω–∞–π–¥–µ–Ω–æ'}</p>
                    
                    ${profiles && profiles.length > 0 ? 
                        '<h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</h4>' + 
                        profiles.map(p => `<p>üìß ${p.email} (${p.name})</p>`).join('') :
                        '<p style="color: orange;">‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>'
                    }
                `;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                if (profiles && profiles.length > 0) {
                    document.getElementById('email').value = profiles[0].email;
                    document.getElementById('password').value = 'Test123456';
                }
                
            } catch (err) {
                result.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
        
        async function testLogin() {
            const result = document.getElementById('result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                result.innerHTML = '<p style="color: red;">–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å</p>';
                return;
            }
            
            result.innerHTML = '<p>–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥...</p>';
            
            try {
                console.log('üîê Attempting login:', email);
                
                const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                console.log('Auth result:', authData, authError);

                if (authError) {
                    result.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${authError.message}</p>`;
                    return;
                }

                if (!authData.user) {
                    result.innerHTML = `<p style="color: red;">‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</p>`;
                    return;
                }

                result.innerHTML = `
                    <p style="color: green;">‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!</p>
                    <p><strong>ID:</strong> ${authData.user.id}</p>
                    <p><strong>Email:</strong> ${authData.user.email}</p>
                    <p><strong>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω:</strong> ${authData.user.email_confirmed_at ? '–î–∞' : '–ù–µ—Ç'}</p>
                    <p><strong>–°–µ—Å—Å–∏—è:</strong> ${authData.session ? '–°–æ–∑–¥–∞–Ω–∞' : '–ù–µ —Å–æ–∑–¥–∞–Ω–∞'}</p>
                `;

            } catch (err) {
                console.error('Login test error:', err);
                result.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
        
        async function registerTestUser() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</p>';
            
            try {
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: 'test@example.com',
                    password: 'Test123456',
                    options: {
                        data: {
                            name: 'Test User'
                        }
                    }
                });

                if (authError) {
                    result.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${authError.message}</p>`;
                    return;
                }

                result.innerHTML = `
                    <p style="color: green;">‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!</p>
                    <p><strong>Email:</strong> test@example.com</p>
                    <p><strong>–ü–∞—Ä–æ–ª—å:</strong> Test123456</p>
                    <p>–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥.</p>
                `;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞
                document.getElementById('email').value = 'test@example.com';
                document.getElementById('password').value = 'Test123456';

            } catch (err) {
                result.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
    </script>
</body>
</html>
