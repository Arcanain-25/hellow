<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>–¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
    <div>
        <input type="email" id="email" placeholder="Email" value="test@example.com">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="Test123456">
        <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
    </div>
    <div id="result"></div>

    <script>
        const supabaseUrl = 'https://ctxzbhofvttxhvxjaise.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0eHpiaG9mdnR0eGh2eGphaXNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMTQ0ODQsImV4cCI6MjA3Mzc5MDQ4NH0.poxWRH3PvsTSX2cW4EP9QAT6VxleRav-d4qwh81tlUo';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function testLogin() {
            const result = document.getElementById('result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            result.innerHTML = '<p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–¥...</p>';
            
            try {
                console.log('üîÑ Attempting login with:', email);
                
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏
                const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                console.log('Auth result:', { authData, authError });

                if (authError) {
                    result.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${authError.message}</p>`;
                    return;
                }

                if (!authData.user) {
                    result.innerHTML = `<p style="color: red;">‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</p>`;
                    return;
                }

                console.log('‚úÖ Auth successful, fetching profile...');

                // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                const { data: profileData, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', authData.user.id)
                    .single();

                console.log('Profile result:', { profileData, profileError });

                if (profileError) {
                    result.innerHTML = `
                        <p style="color: orange;">‚ö†Ô∏è –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω, –Ω–æ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
                        <p>User ID: ${authData.user.id}</p>
                        <p>Email: ${authData.user.email}</p>
                        <p>–û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è: ${profileError.message}</p>
                    `;
                } else {
                    result.innerHTML = `
                        <p style="color: green;">‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!</p>
                        <p>ID: ${profileData.id}</p>
                        <p>Email: ${profileData.email}</p>
                        <p>–ò–º—è: ${profileData.name}</p>
                        <p>–°–æ–∑–¥–∞–Ω: ${profileData.created_at}</p>
                    `;
                }

            } catch (err) {
                console.error('‚ùå Login test error:', err);
                result.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
    </script>
</body>
</html>
